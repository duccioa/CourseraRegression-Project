---
output: pdf_document
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE, cache=FALSE)
```

```{r Packages, include=FALSE}
require(ggplot2)
require(tidyr)
require(dplyr)
require(grid)
require(gridExtra)
```

EXECUTIVE SUMMARY
```{r}
#The whole point of an executive summary is to compress a lengthy report in a few sentences so that a person with very limited time to invest (like an executive director) would be able to understand what the whole thing is about. It should include all: the problem, the methods used and the results obtained.
```
This report aims at investigating the following questions on the base of the database mtcars:

1. Is an automatic or manual transmission better for MPG (miles per gallons)     
2. Quantify the MPG difference between automatic and manual transmissions     

The database contains `r length(mtcars$am)` car models of which `r table(mtcars$am)[1]` have automatic transmission and `r table(mtcars$am)[2]` have manual.

```{r Dataset, fig.width=11}
data(mtcars)
#mtcars$cyl <- factor(mtcars$cyl); mtcars$vs <- factor(mtcars$vs) 
#mtcars$am <- factor(mtcars$am); mtcars$gear <- factor(mtcars$gear) 
#mtcars$carb <- factor(mtcars$carb)
#add a column with origin
#mtcars$imp <- 1
#mtcars$imp[c(1:3, 8:14, 18:21, 26:28, 30:32)] <- 0
#mtcars$imp <- as.logical(mtcars$imp)
head(mtcars)
```

```{r Exploratory graph creation, fig.width=9, include=FALSE}
names_var <- names(select(mtcars, -mpg))
out <- NULL
g <- ggplot(mtcars, aes(y = mpg))
for(i in 1:length(names_var)){
    
    g <- g + aes_string(x = names_var[i]) + geom_point(aes(colour = factor(am))) + geom_smooth(method = "lm", aes(group = 1)) + guides(colour = FALSE)
    
    out[[i]] <- g # creates a list with all the plots 
}
grid.arrange(out[[1]], out[[2]], out[[3]], out[[4]], out[[5]], out[[6]], out[[7]], out[[8]], out[[9]], out[[10]], nrow = 2)
```
    
First we check the null hypothesis that manual and automatic transmissions cars are from the same population (the variable "am" is 0 for automatic transmission and 1 for manual.). For the sake of this projects we assume "mpg" to have a normal distribution, although it looks a little skewed. 
```{r T.test, include = FALSE}
t <- t.test(mtcars$mpg ~ mtcars$am)
```
A simple t-test confirm that the two transmissions are not from the same population as the interval does not contain 0 and the p-value `r t$p.value` is sufficiently low.
```{r t.test interval}
t$conf.int
```

We consider a linear model with "am" as a predictor and "mpg" as a response.    
   
```{r Fit model 1, fig.height= 3, fig.width= 4}
out[[8]]
fit_am <- lm(mpg ~ am, mtcars)
summary(fit_am)
```
The relatevly high F-statistic and the very low p-value confirm that there might be a correlation, but if we look at how well the model fit, R-squared `r round(summary(fit_am)$r.squared, 3)` is very low (1 being best fit, 0 being no fit at all). This, together with a Residual Standard Error (RSE) of `r round(sd(summary(fit_am)$residuals), 3)`, suggests that the model is not very accurate and that there might be other model to better explain the correlation.
We look therefore to other variables that might be confounder. Based on a brief literature review the variables that can be relevant to our analysis are weight, displacement (the amount of fuel burnt per stroke of the engine), the number of cylinders and the rear axle ratio (drat in dataset).
The number of cylinders can tell a lot about a car because it is related to the size and power of the engine and therefore the size and the type of the car. Displacement gives similar information about the engine. The weight combined with the number of cylinders and the displacement, can tell whether we are talking about a small car (small cyl, wt and disp therefore high mpg), a big car (high cyl, wt and disp and low mpg) or a sport car (high cyl and disp, low weight, low mpg). 

```{r cyl and disp}
fit_cyl <- lm(mpg ~ cyl, mtcars)
fit_cyl_disp <- update(fit_cyl, mpg ~ cyl + disp)
```
The predictor "cyl" explains 





APPENDIX
Exploratory graphs

```{r, fig.width=9, cache=TRUE, results=TRUE, echo=FALSE}
grid.arrange(out[[1]], out[[2]], out[[3]], out[[4]], out[[5]], out[[6]], out[[7]], out[[8]], out[[9]], out[[10]], nrow = 2)
```